# üèóÔ∏è Park Hotel - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*–ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è: 2025-01-11*

## üéØ –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã –ø—Ä–æ–µ–∫—Ç–∞

### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å)
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ç—Ä—ë—Ö —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:

1. **–í–ï–©–¨ (–°—É–±—Å—Ç–∞–Ω—Ü–∏—è)**
   - `Tours` - —Ç—É—Ä—ã –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
   - `Spaces` - –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –æ—Ç–µ–ª—è –∫–∞–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã  
   - `Bookings` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏—è
   - `Reviews` - –æ—Ç–∑—ã–≤—ã –∫–∞–∫ –º–Ω–µ–Ω–∏—è

2. **–°–í–û–ô–°–¢–í–û (–ê—Ç—Ä–∏–±—É—Ç)**
   - –ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω–∞ - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
   - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å - –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
   - –†–µ–≥–∏–æ–Ω, —Ç–∏–ø –Ω–æ–º–µ—Ä–∞ - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
   - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å - —Å–æ—Å—Ç–æ—è–Ω–∏—è

3. **–û–¢–ù–û–®–ï–ù–ò–ï (–†–µ–ª—è—Ü–∏—è)**
   - –¢—É—Ä ‚Üî Availability (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
   - Space ‚Üî Images (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
   - Booking ‚Üî Tour/Space (–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É)
   - Review ‚Üî Booking (–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)

### –°–∏–ª–ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ
```
–ë–æ–ª—å—à–∞—è –ø–æ—Å—ã–ª–∫–∞: –í—Å–µ —Ç—É—Ä—ã –∏–º–µ—é—Ç –¥–∞—Ç—ã –∑–∞–µ–∑–¥–æ–≤
–ú–∞–ª–∞—è –ø–æ—Å—ã–ª–∫–∞: –ì–æ—Ä–Ω—ã–π —Ç—É—Ä - —ç—Ç–æ —Ç—É—Ä  
–ó–∞–∫–ª—é—á–µ–Ω–∏–µ: –ì–æ—Ä–Ω—ã–π —Ç—É—Ä –∏–º–µ–µ—Ç –¥–∞—Ç—ã –∑–∞–µ–∑–¥–æ–≤
```

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –†–µ–∞–∫—Ç–∏–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Convex)
```
Database ‚îÄ‚îÄreactive‚îÄ‚îÄ> Frontend
    ‚Üì                     ‚Üë
  Updates              Mutations
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã (real-time)
- Optimistic updates –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- Type-safe API –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2. –§–∞–π–ª–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
convex/
‚îú‚îÄ‚îÄ schema.ts          # –õ–æ–≥–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å (–í–µ—â–∏ + –°–≤–æ–π—Å—Ç–≤–∞)
‚îú‚îÄ‚îÄ tours.ts           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç—É—Ä–æ–≤
‚îú‚îÄ‚îÄ spaces.ts          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤
‚îú‚îÄ‚îÄ availability.ts    # –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–û—Ç–Ω–æ—à–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ files.ts           # –ú–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç
‚îî‚îÄ‚îÄ seed.ts           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

app/
‚îú‚îÄ‚îÄ layout.tsx        # –ö–æ—Ä–Ω–µ–≤–∞—è –æ–±—ë—Ä—Ç–∫–∞
‚îú‚îÄ‚îÄ providers.tsx     # Convex Provider
‚îú‚îÄ‚îÄ tours/page.tsx    # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—É—Ä–æ–≤
‚îî‚îÄ‚îÄ spaces/page.tsx   # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–æ–º–µ—Ä–æ–≤

components/
‚îú‚îÄ‚îÄ TourCard.tsx             # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–∞
‚îú‚îÄ‚îÄ TourAvailabilityModal.tsx # –ü–æ–ø–∞–ø —Å –¥–∞—Ç–∞–º–∏
‚îî‚îÄ‚îÄ SpaceCard.tsx           # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞

hooks/
‚îî‚îÄ‚îÄ useConvex.ts      # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ Convex API
```

### 3. –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É —Å—É—â–Ω–æ—Å—Ç—å:
- `tours.ts` - —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç—É—Ä–∞–º–∏
- `availability.ts` - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  
- `files.ts` - —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞

---

## üóÉÔ∏è –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –§–∏–ª–æ—Å–æ—Ñ–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
**–ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏**: —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω–µ–ª—å–∑—è –≤—ã—á–∏—Å–ª–∏—Ç—å.

#### –¢–∞–±–ª–∏—Ü–∞ `availability`
```typescript
{
  tour_id: Id<"tours">,
  start_date: number,     // –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –¥–∞—Ç–∞ –≤ –ë–î
  occupied_spots: number, // –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï —á–∏—Å–ª–æ –≤ –ë–î
  // end_date - –í–´–ß–ò–°–õ–Ø–ï–¢–°–Ø: start_date + tour.duration_days
  // available_spots - –í–´–ß–ò–°–õ–Ø–ï–¢–°–Ø: tour.max_participants - occupied_spots
  // is_available - –í–´–ß–ò–°–õ–Ø–ï–¢–°–Ø: occupied_spots < max_participants
}
```

**–õ–æ–≥–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ä–∞ ‚Üí –Ω–µ —Ö—Ä–∞–Ω–∏–º
- –°–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞ ‚Üí –Ω–µ —Ö—Ä–∞–Ω–∏–º  
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Üí –Ω–µ —Ö—Ä–∞–Ω–∏–º

#### –¢–∞–±–ª–∏—Ü–∞ `spaces` - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```typescript
{
  images: string[], // –ú–∞—Å—Å–∏–≤ storageId
  // URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –í–´–ß–ò–°–õ–Ø–Æ–¢–°–Ø —á–µ—Ä–µ–∑ getFileUrl(storageId)
}
```

**–õ–æ–≥–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- URL –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ö–æ—Å—Ç–∏–Ω–≥–∞ ‚Üí –Ω–µ —Ö—Ä–∞–Ω–∏–º
- storageId –Ω–µ–∏–∑–º–µ–Ω–µ–Ω ‚Üí —Ö—Ä–∞–Ω–∏–º
- –°–≤—è–∑—å one-to-many —á–µ—Ä–µ–∑ –º–∞—Å—Å–∏–≤

---

## üîÑ –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã

### 1. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—É—Ä–∞
```mermaid
graph TD
    A[–°–æ–∑–¥–∞–Ω–∏–µ —Ç—É—Ä–∞] --> B[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç –∑–∞–µ–∑–¥–æ–≤]
    B --> C[–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç—É—Ä–∞]
    C --> D[–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç]
    D --> E[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏]
    E --> F{–ú–µ—Å—Ç–∞ –µ—Å—Ç—å?}
    F -->|–î–∞| D
    F -->|–ù–µ—Ç| G[–¢—É—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω]
    G --> H[–ù–æ–≤–∞—è –¥–∞—Ç–∞ –∑–∞–µ–∑–¥–∞]
    H --> C
```

### 2. –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∫–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```typescript
function getTourAvailability(tour_id) {
  // 1. –ü–æ–ª—É—á–∞–µ–º —Ç—É—Ä –¥–ª—è max_participants –∏ duration_days
  const tour = await db.get(tour_id);
  
  // 2. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ availability –∑–∞–ø–∏—Å–∏
  const availabilities = await db.query("availability")
    .withIndex("by_tour", q => q.eq("tour_id", tour_id))
    .collect();
  
  // 3. –í–´–ß–ò–°–õ–Ø–ï–ú –≤—Å–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  return availabilities.map(item => ({
    start_date: item.start_date,
    end_date: item.start_date + (tour.duration_days * 24 * 60 * 60 * 1000),
    total_capacity: tour.max_participants,
    occupied_spots: item.occupied_spots,
    available_spots: tour.max_participants - item.occupied_spots,
    is_available: item.occupied_spots < tour.max_participants,
    price: tour.price
  }));
}
```

### 3. Workflow –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É
const selectedDate = availability[index];

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å  
if (selectedDate.available_spots >= guestsCount) {
  // –ë—Ä–æ–Ω–∏—Ä—É–µ–º
  await updateTourOccupancy({
    tour_id: tour._id,
    start_date: selectedDate.start_date,
    spots_change: +guestsCount // –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–û–ï —á–∏—Å–ª–æ
  });
}

// –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
await updateTourOccupancy({
  tour_id: tour._id, 
  start_date: selectedDate.start_date,
  spots_change: -guestsCount // –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–û–ï —á–∏—Å–ª–æ
});
```

---

## ‚öõÔ∏è Frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
// –§–∏–ª–æ—Å–æ—Ñ–∏—è: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç = —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç –¥–∞–Ω–Ω—ã—Ö
function TourCard({ tour }) {
  const imageUrl = useFileUrl(tour.main_image); // –†–µ–∞–∫—Ç–∏–≤–Ω–æ!
  
  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç props –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  return (
    <div>
      {imageUrl && <Image src={imageUrl} alt={tour.title} />}
      <h3>{tour.title}</h3>
      <p>{tour.price.toLocaleString()} ‚ÇΩ</p>
    </div>
  );
}
```

### 2. –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
```typescript
// Convex Query States
const data = useQuery(api.tours.getAllTours);

if (data === undefined) {
  // LOADING - –∑–∞–ø—Ä–æ—Å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
  return <Spinner />;
}

if (data.length === 0) {
  // EMPTY - –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω, –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
  return <EmptyState />;  
}

// SUCCESS - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã
return <TourList tours={data} />;
```

### 3. –ü—Ä–∏–Ω—Ü–∏–ø –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
```typescript
// –ë–æ–ª—å—à–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç = –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–∞–ª–µ–Ω—å–∫–∏—Ö
function ToursPage() {
  return (
    <div>
      <TourList />               // –°–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤
      <TourAvailabilityModal />  // –ü–æ–ø–∞–ø —Å –¥–∞—Ç–∞–º–∏  
    </div>
  );
}

// –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
function TourList() {
  const tours = useTours();
  return tours?.map(tour => <TourCard key={tour._id} tour={tour} />);
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 1. –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```typescript
// ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏–º —Å–µ–∫—Ä–µ—Ç—ã –≤ frontend
const ADMIN_KEY = "secret"; // –ü–õ–û–•–û!

// ‚úÖ –¢–æ–ª—å–∫–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
// .env.local (–Ω–µ –≤ git!)
CONVEX_SELF_HOSTED_ADMIN_KEY=secret_key

// ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ö–µ–º—ã
export default defineSchema({
  tours: defineTable({
    price: v.float64(), // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ mutation handlers
  })
});
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
.index("by_tour_date", ["tour_id", "start_date"])

// ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, –Ω–µ –≤ JavaScript
const availabilities = await ctx.db.query("availability")
  .withIndex("by_tour", q => q.eq("tour_id", args.tour_id))
  .collect(); // –°—Ä–∞–∑—É –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

// ‚ùå –ù–ï —Ñ–∏–ª—å—Ç—Ä—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ
const all = await ctx.db.query("availability").collect();
const filtered = all.filter(item => item.tour_id === args.tour_id);
```

### 3. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```typescript
// Convex –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç file URLs
const imageUrl = useFileUrl(storageId); 
// –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–∑–æ–≤–µ —Å —Ç–µ–º –∂–µ storageId = –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
1. **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤**: < 500ms
2. **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: < 1s  
3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API**: 99.9%
4. **–†–∞–∑–º–µ—Ä bundle**: < 500KB

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ—á–∫–∏
```typescript
// –í production –¥–æ–±–∞–≤–∏—Ç—å:
console.time('tours-load');
const tours = useTours();
if (tours) console.timeEnd('tours-load');

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
try {
  await createTour(data);
} catch (error) {
  console.error('Tour creation failed:', error);
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ monitoring service
}
```

---

## üîÑ CI/CD Pipeline

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å
1. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: `npm run dev`
2. **Deploy —Ñ—É–Ω–∫—Ü–∏–π**: `npx convex deploy`  
3. **Build frontend**: `npm run build`
4. **Deploy –Ω–∞ Railway**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ push

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
```yaml
# .github/workflows/deploy.yml
name: Deploy
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
      - name: Install deps
        run: npm ci
      - name: Deploy Convex
        run: npx convex deploy
        env:
          CONVEX_SELF_HOSTED_URL: ${{ secrets.CONVEX_URL }}
          CONVEX_SELF_HOSTED_ADMIN_KEY: ${{ secrets.CONVEX_ADMIN_KEY }}
      - name: Build & Deploy
        run: npm run build
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### Unit —Ç–µ—Å—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```typescript
// tests/availability.test.ts
test('calculateEndDate should add tour duration to start date', () => {
  const startDate = new Date('2025-01-15').getTime();
  const durationDays = 7;
  const expected = new Date('2025-01-22').getTime();
  
  const result = startDate + (durationDays * 24 * 60 * 60 * 1000);
  expect(result).toBe(expected);
});

test('calculateAvailableSpots should subtract occupied from total', () => {
  const maxParticipants = 12;
  const occupiedSpots = 8;
  const expected = 4;
  
  const result = maxParticipants - occupiedSpots;
  expect(result).toBe(expected);
});
```

### Integration —Ç–µ—Å—Ç—ã
```typescript
// tests/convex.integration.test.ts
test('should create tour and availability', async () => {
  const tourId = await convex.mutation(api.tours.createTour, {
    title: "Test Tour",
    duration_days: 5,
    max_participants: 10,
    // ...
  });
  
  const availabilityId = await convex.mutation(api.availability.createTourDate, {
    tour_id: tourId,
    start_date: Date.now(),
    occupied_spots: 0
  });
  
  const availability = await convex.query(api.availability.getTourAvailability, {
    tour_id: tourId
  });
  
  expect(availability).toHaveLength(1);
  expect(availability[0].available_spots).toBe(10);
});
```

---

## üöÄ Roadmap —Ä–∞–∑–≤–∏—Ç–∏—è

### –§–∞–∑–∞ 1: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚úÖ
- [x] Convex setup –∏ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- [x] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç—É—Ä–æ–≤ –∏ –Ω–æ–º–µ—Ä–æ–≤  
- [x] –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å –¥–∞—Ç–∞–º–∏ –∑–∞–µ–∑–¥–æ–≤
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] Frontend —Å –ø–æ–ø–∞–ø–∞–º–∏ –∏ –º–æ–¥–∞–ª–∞–º–∏

### –§–∞–∑–∞ 2: –ê–¥–º–∏–Ω–∫–∞ –∏ UX üîÑ
- [ ] –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥–∂–µ—Ç –¥–ª—è –¥–∞—Ç –∑–∞–µ–∑–¥–æ–≤
- [ ] –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

### –§–∞–∑–∞ 3: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ üìÖ
- [ ] –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å —Ñ–æ—Ä–º–∞–º–∏
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Convex actions
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤ –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

### –§–∞–∑–∞ 4: Production üèóÔ∏è
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ meta tags
- [ ] PWA –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–∑–∞ 5: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ üìà
- [ ] CDN –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–∞–ª–∏–∑–∞—Ü–∏—è (i18n)

---

## üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. DRY (Don't Repeat Yourself)
- –û–±—â–∏–µ —Ö—É–∫–∏ –≤ `useConvex.ts`
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`TourCard`, `SpaceCard`)
- –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ –∏–∑ Convex —Å—Ö–µ–º

### 2. SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **S**: –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
- **O**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –Ω–æ–º–µ—Ä–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- **L**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç –±–∞–∑–æ–≤—ã–µ props
- **I**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã (tours !== spaces)
- **D**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (hooks), –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö API

### 3. KISS (Keep It Simple, Stupid)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
- –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –ª–æ–≥–∏–∫–∏
- –ü—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–π flow –¥–∞–Ω–Ω—ã—Ö: DB ‚Üí Hook ‚Üí Component

---

*–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞: 2025-01-11*  
*–°—Ç–∞—Ç—É—Å: Production Ready ‚úÖ*  
*–°–ª–µ–¥—É—é—â–∏–π review: –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö —Ñ–∏—á*